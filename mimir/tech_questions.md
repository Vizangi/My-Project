# **Технические вопросы о Mimir к собеседованию**

### 1. **Сколько экземпляров Mimir может использоваться?**

Mimir — это распределенная система для хранения метрик, разработанная Grafana Labs. Она спроектирована как высокомасштабируемое решение, способное работать в кластерном режиме. Это означает, что количество экземпляров Mimir ограничено только ресурсами вашего инфраструктурного окружения (например, серверов, сети, хранилища) и требованиями к производительности.

- **Минимальная конфигурация**: Для работы Mimir требуется минимум три экземпляра, если вы хотите обеспечить отказоустойчивость (high availability). Это связано с тем, что Mimir использует распределенные алгоритмы согласования (например, Raft или другие), которые требуют большинства узлов для корректной работы.
  
- **Масштабирование**: Теоретически, вы можете запустить сотни или даже тысячи экземпляров Mimir в крупных распределенных системах. Однако на практике количество экземпляров зависит от:
  - Объема данных (метрик), которые нужно обрабатывать.
  - Требований к задержкам (latency) при записи и чтении.
  - Доступных ресурсов (CPU, RAM, дисковое пространство).
  - Конфигурации шардирования (sharding) и репликации.

Таким образом, количество экземпляров Mimir ограничено только архитектурными и ресурсными пределами вашей инфраструктуры.

---

### 2. **Сколько экземпляров Prometheus могут писать в один кластер Mimir?**

Prometheus может быть настроен на отправку данных в Mimir через remote write API. Здесь важно учитывать несколько факторов:

- **Архитектурные возможности**:
  - Mimir спроектирован как централизованное решение для приема метрик, и он может обрабатывать данные от множества экземпляров Prometheus одновременно.
  - Количество Prometheus, которые могут писать в Mimir, зависит от:
    - Пропускной способности сети.
    - Производительности Mimir (особенно компонентов ingester и distributor).
    - Объема данных, отправляемых каждым экземпляром Prometheus.

- **Практические ограничения**:
  - В реальных сценариях десятки или даже сотни экземпляров Prometheus могут успешно писать данные в один кластер Mimir.
  - Например, если каждый экземпляр Prometheus отправляет 100,000–1,000,000 метрик в минуту, то Mimir должен быть правильно настроен для обработки такого трафика (например, увеличение количества ingester'ов или оптимизация шардирования).

- **Рекомендации**:
  - Используйте балансировку нагрузки (например, через NGINX или Kubernetes Service) для равномерного распределения запросов между узлами Mimir.
  - Мониторьте производительность Mimir (например, задержки записи, использование памяти и CPU) для своевременного масштабирования.

---

### 3. **Какие дополнительные факторы стоит учитывать?**

- **Нагрузка на NGINX**:
  Если вы используете NGINX как прокси для балансировки нагрузки между экземплярами Mimir, убедитесь, что он настроен на обработку высокого числа запросов. Возможно, потребуется настроить параметры `worker_connections`, `keepalive_timeout` и другие.

- **Шардирование и репликация**:
  Mimir поддерживает шардирование данных между узлами, что позволяет масштабировать систему горизонтально. Также можно настроить репликацию для повышения надежности.

- **Мониторинг и логирование**:
  Регулярно мониторьте состояние Mimir и Prometheus, чтобы избежать перегрузок. Используйте инструменты, такие как Grafana, для анализа производительности системы.

---

### Итоговый ответ:

1. **Количество экземпляров Mimir**: Теоретически не ограничено, но минимальная конфигурация для отказоустойчивости — 3 экземпляра. На практике количество зависит от объема данных и доступных ресурсов.

2. **Количество Prometheus, пишущих в Mimir**: Ограничено только производительностью Mimir и сетевой пропускной способностью. В реальных сценариях десятки или сотни экземпляров Prometheus могут успешно писать данные в один кластер Mimir.
